<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KYHSS ATHAVANAD</title>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Reem+Kufi:wght@400;700&display=swap" rel="stylesheet">
    <style>
        
    </style>

    <style>
         @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Malayalam:wght@400;700&display=swap');
            
        .arabic {
            font-size: 30px;
            margin-bottom: 0px;
            font-family: 'Reem Kufi', sans-serif;
            font-weight: 100;
        }
        .malayalam {
        font-size:18px;
                font-family: "Karthika", "Noto Sans Malayalam", sans-serif;
            }
            #campus{
            font-size:15px;
            }
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            text-align: center;
            padding: 20px;
            align-items:center;
            
        }

        .container {
            max-width: 600px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        input, button {
            width: 90%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        button {
            background-color: #28a745;
            color: white;
            cursor: pointer;
        }

        button:hover {
            background-color: #218838;
        }
        
        .progress-card {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-top: 20px;
        }

        .progress-card h2 {
            color: #333;
        }

        .progress-card p {
            font-size: 14px;
            color: #555;
            text-align:left;
        }

        .progress-card table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .progress-card table, th, td {
            border: 1px solid #ddd;
        }

        .progress-card th, td {
            padding: 8px;
            text-align: center;
        }

        .progress-card th {
            background: #007bff;
            color: white;
        }
#progressCardContainer {
display:flex;
margin:auto;
    width:20cm;
        max-width:20cm;
        max-height:26cm;
        width: 100%;
        padding: 5px;
        font-size: 11px; /* Adjust font size for readability */
        text-align:center;

    }
    
    #progressard .faild{
        background: #f5352b;
            color: white;
            padding: 10px;
            margin-top: 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            animation: fadeIn 1.5s ease-in-out;
    }
    #progressard .congratulations {
            background: #28a745;
            color: white;
            padding: 10px;
            margin-top: 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            animation: fadeIn 1.5s ease-in-out;
        }

        @keyframes fadeIn {

            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @media screen and (max-width: 768px) {
            #notification{
                width: 95%;
                margin: 0 auto;
                background-color: antiquewhite;
                height: 90vh;
                overflow: auto;
            }
            #notification #closeNotification{
                margin: auto;
                    max-width: 30px;
                    background-color: #f5352b;
                    color: white;
                    left: 90%;
                    margin-top:0px;
                    position:absolute;
                    
            }
            img{
                margin-bottom: 0px;
                padding: 1px;
                width: 100px;
                height: 100px;
                object-fit: fill;
            }
        container{
        width:100%;
        }
        h2{
        font-size:13px;
        }
        .arabic {
            font-size: 20px;
            margin-bottom: 0px;
            font-family: 'Reem Kufi', sans-serif;
            font-weight: 100;

        }
        .malayalam {
        font-size:14px;
                font-family: sans-serif;
            }
            #campus{
            font-size:10px;
            }
    #progressCardContainer {
    width:20cm;
        max-width:20cm;
        max-height:26cm;
        width: 100%;
        padding: 5px;
        font-size: 11px; /* Adjust font size for readability */
    }

    .header {
        text-align: center;
        font-size: 11px;
    }

    .student-info {
        display: block; /* Stack elements vertically */
        text-align: center;
    }

    .table-container {
        overflow-x: auto; /* Enable horizontal scrolling for tables */
    }

    table {
        padding: 5px;
        width: 100%;
        font-size: 11px; /* Reduce table font size */
    }

    .button-container {
        text-align: center;
        padding: 10px 0;
    }

    .download-btn {
        width:fit-content;
        padding: 12px;
        font-size: 16px;
    }
    .congratulations {
            background: #28a745;
            color: white;
            padding: 10px;
            margin-top: 15px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            animation: fadeIn 1.5s ease-in-out;
        }
}

        @media print {
        .hidePrint{
        display:none;}
    #progressCardContainer {
        width: 100%;
        font-size: 14px;
    }

    table {
        page-break-inside: auto;
    }

    tr {
        page-break-inside: avoid;
        page-break-after: auto;
    }
}

    </style>
</head>
<body>
    <div id="nonePrint" style="display: block;">
    
    
        
    <div id="searchField" class="container" style="display:block;">
        <div>
            <br>
             <h3 class="arabic">KYHSS ATHAVANAD</h3>
             <h2> School Madrassa</h2>
            <img id="loginemblom3" src="https://drive.google.com/thumbnail?id=1BKHBRTLhL6xokJ-Bz8fkM3hjllsKIqvb&sz=800" width="100" height="100">
           
            <h3  style="margin-top:0px;margin-bottom:0.3em;" class="malayalam">School Code:19094 : HSS Code :11118</h3>
            <h3 id="campus" style="margin-top: 0.2em;">PMSA ORPHANAGE CAMPUS KATTILANGADI</h3>
          </div>
          <h2 style="margin-bottom: -10px; bottom: 10px;">ISLAMIC STUDIES </h2>
        <h2 style="color:red">Annual Examination Result</h2>
        <input type="text" id="searchAdnumber" placeholder="Enter AD Number">
        <input type="text" id="searchClass" placeholder="Enter Class">
                    <input type="text" id="searchDivision" placeholder="Enter Division" onchange="capitalizeDivision()">

<script>
function capitalizeDivision() {
  const input = document.getElementById("searchDivision");
  if (input) {
    input.value = input.value.toUpperCase();
  }
}
</script>
        <button id="searchBtn">Get Result</button>
        <div id="loadingColor" style="display: none;">
            Loading....your Results....
        </div>
        <script>
        function loading(is) {
  const div = document.getElementById("loadingColor");
  div.style.display = is;
  div.style.color = randomColor();
  //div.style.fontSize = randomFontSize();

  // Change color and size every 0.5 seconds
  let intervalId = setInterval(() => {
    div.style.color = randomColor();
   // div.style.fontSize = randomFontSize();
  }, 50);

//   // Stop changing after 5 seconds (optional)
//   setTimeout(() => {
//     clearInterval(intervalId);
//   }, 5000);

  function randomColor() {
    var r = Math.floor(Math.random() * 1677721).toString(16);
    return "#" + r;
  }

  function randomFontSize() {
    return Math.floor(Math.random() * 6 + 12) + "px"; // Font size between 12px and 17px
  }
}

    </script>
    </div>
        <div id="printBtn" class="hidePrint" style="display:none; position:relative; margin-top:10px; margin-right:10px; justify-content: flex-end;">
            <button style="width:fit-content; text-align:center; margin-right: 5px;" onclick="printProgressCard()">Print</button>
            <button onclick="gotoSearch()" style="width:fit-content; background-color:blue; color:white;">Check Another Result</button>
        </div>
        <div id="notification" style="display: none; 
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    max-width: 500px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow: hidden;
    transition: all 0.3s ease;
    border: 1px solid rgba(0, 123, 255, 0.3);
    overflow-y: auto;
    ">
    
    <div id="notificationHeader" style="
    position: sticky;
    top:0px;
        background: linear-gradient(135deg, #007bff, #00b4ff);
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;">
        
        <h3 style="margin: 0; font-weight: 600;">KYHSS ATHAVANAD</h3>
        <button id="closeNotification"onclick=" closeNotification() " style="
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0 5px;">√ó</button>
    </div>
    
    <div id="notificationMessage" style="padding: 20px;">
        <p style="
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
            font-weight: 500;">
            <strong>Notification About Annual Term</strong>
        </p>
        
        <div style="
            
            background: #f9fbfa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #007bff;">
            <h4 style="margin: 0 0 10px 0; color: #495057;">
                <strong>promotion Criteria</strong>
            </h4>
            <p id="criteria" style="margin: 0; color: #6c757d; line-height: 1;">
                <!-- Your notification content here -->
                 <br>
                <li style="color: #317c41;" >"Students who achieved a TE mark of 30% or above were considered proficient and passed the exam."
        
                </li>
                <br>
                <hr>
                <li style="color: #e65954;">
                    "Any student with an insufficient TE mark, falling below 30%, was marked as failed."
                </li>
                <hr>
                <br>
                <div style="align-content: center; width: 100%; text-align: center;justify-items: center;">
                    <br>
                    <strong>Grading criteria</strong>
                    <br>
                    <hr>
                    <table border="1" style="width: 100%; border-collapse: collapse; border: 1px solid #000000; font-size: 14px;">
                        <thead style="border: 1px solid #000000;">
                            <td>Percentage </td>
                            <td> grade </td>
            
                        </thead>
                        <tbody id="gradeCriteria"></tbody>
                    </table>
                </div>
                
            </p>
            
        </div>
       
        <button id="getResultBtn"onclick=" closeNotification() " style="
            display: none;
            width: 100%;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: rgb(232, 228, 228);
            border: none;
            padding: 12px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 10px;">
            Get Result
        </button>
        
    </div>
    
        </div>

   
    
    <div id="progressCardContainer" style="display: none;"></div>
    </div>
   <div id="printArea" style="display: none;">
    <div style="display: flex;justify-content: right;">
        
    <button class="hidePrint" style="width: fit-content;gap: 30px;" type="button" onclick="togglePrint();">close</button>
    <button class="download-btn hidePrint" onclick="downloadPDF()">Download PDF</button>
    
    </div>
    <div style="max-width:20cm;max-height:27cm; margin:10px;" id="printContents"></div>
    
   </div>
   
   <script>
    function displayGradingCriteria(className) {
        document.getElementById('notification').style.display = 'block';

// To show the close button (if needed)
document.getElementById('closeNotification').style.display = 'block';
  const gradeCriteriaTable = document.getElementById("gradeCriteria");
  gradeCriteriaTable.innerHTML = ""; // Clear previous content

  let gradingSystem = [];

  if (className > "7") {
    // Grading system for classes above 7 (A+, A, B, etc.)
    gradingSystem = [
      { percentage: "90-100", grade: "A+" },
      { percentage: "80-89", grade: "A" },
      { percentage: "70-79", grade: "B+" },
      { percentage: "60-69", grade: "B" },
      { percentage: "50-59", grade: "C+" },
      { percentage: "40-49", grade: "C" },
      { percentage: "30-39", grade: "D+" },
      { percentage: "Below 40", grade: "D" }, // Or "Fail"
    ];
  } else {
    // Grading system for classes 7 and below (A, B, C, D, E)
    gradingSystem = [
      { percentage: "85-100", grade: "A" },
      { percentage: "70-84", grade: "B" },
      { percentage: "55-69", grade: "C" },
      { percentage: "30-54", grade: "D" },
      
      { percentage: "Below 30", grade: "F" }, // Or "Fail"
    ];
  }

  // Populate the table
  gradingSystem.forEach((criteria) => {
    const row = document.createElement("tr");
    const percentageCell = document.createElement("td");
    const gradeCell = document.createElement("td");

    percentageCell.textContent = criteria.percentage;
    gradeCell.textContent = criteria.grade;

    row.appendChild(percentageCell);
    row.appendChild(gradeCell);
    gradeCriteriaTable.appendChild(row);
  });
}

// Example usage:
// Call this function when you want to display the grading criteria, passing the class name.
// For example:
// displayGradingCriteria("8"); // For classes above 7
// displayGradingCriteria("6"); // For classes 7 and below
    function gotoSearch(){
    document.getElementById("searchField").style.display="block";
    
    document.getElementById("progressCard").innerHTML ="";
    //document.getElementById("progressCardContainer").style.display="none";
    document.getElementById("printBtn").style.display="none";

    }
        function togglePrint(){
            const progressCardContainer = document.getElementById("progressCardContainer");
    const printArea = document.getElementById("printArea");
    const nonePrintElements = document.getElementById("nonePrint"); //document.querySelectorAll(".nonePrint");
            document.getElementById("nonePrint").style.display="block";
            document.getElementById("printArea").style.display="none";
            printArea.style.display = "none"; // Hide print area again
    nonePrintElements.forEach(element => element.style.display = "block");
    
        }
// Example usage in your displayProgressCard function:
//progressHTML += `<button onclick="saveProgressCardAsPDF()">Save as PDF</button>`; // Call the function
        async function downloadPDF() {
            const element = await document.getElementById("printContents"); // Target the progress card container
            html2pdf().from(element).save("Progress_Card.pdf");
        }


function printProgressCard() {

    const progressCardContainer = document.getElementById("progressCardContainer");
    const printArea = document.getElementById("printArea");
    const printContents = document.getElementById("printContents");

    const nonePrintElements = document.getElementById("nonePrint"); //document.querySelectorAll(".nonePrint");
    

    if (!progressCardContainer || !printArea) {
        console.error("Required elements not found.");
        return;
    }

    // Hide non-printable elements
    //nonePrintElements.forEach(element => element.style.display = "none");
        //nonePrintElements.style.display="none";
    // Copy progress card content into printArea
    printContents.innerHTML = progressCardContainer.innerHTML;
    printArea.style.display = "block"; // Show print area
    nonePrintElements.style.display="none";
    // Wait a moment before printing to allow the browser to render content
    setTimeout(() => {
        window.print();

        // Restore elements after printing
       // printArea.style.display = "none";
        //nonePrintElements.forEach(element => element.style.display = "block");
    }, 500); // 500ms delay
}
function closeNotification(){
// To show the notification
document.getElementById('notification').style.display = 'none';

// To show the close button (if needed)
document.getElementById('closeNotification').style.display = 'none';
document.getElementById('progressCardContainer').style.display = 'block';


}

// To show the Get Result button
document.getElementById('getResultBtn').style.display = 'block';

function getGrade(maxMark, obtMark ,clason) {
    const percentage = (obtMark / maxMark) * 100;
if(clason > 7){
    if (percentage >= 90) {
        return "A+";
    } else if (percentage >= 80) {
        return "A";
    } else if (percentage >= 70) {
        return "B+";
    } else if (percentage >= 60) {
        return "B";
    } else if (percentage >= 50) {
        return "C+";
    } else if (percentage >= 40){
        return "C";
    }else if (percentage >= 30){
        return "D+";
    }else{
        return "D"
    }
}else{
    if (percentage >= 85) {
        return "A";
    } else if (percentage >= 70) {
        return "B";
    } 
     else if (percentage >= 55) {
        return "C";
    
    }else if (percentage >= 30){
        return "D";
    }else{
        return "F"
    }
}
}



    </script>
     <script type="module">
        import { db } from "./firebase-config.js";
        import { collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";

        document.getElementById("searchBtn").addEventListener("click", async () => {
            const adnumber = document.getElementById("searchAdnumber").value.trim();
            const studentClass = document.getElementById("searchClass").value.trim();
            const division = document.getElementById("searchDivision").value.trim();

            if (!adnumber || !studentClass || !division) {
                alert("‚ùå Please enter all details.");
                return;
            }
            var classt = studentClass+" "+division; 
            if (parseInt(adnumber) === 4789 && division === "ADMIN") {
                alert("Admin access granted");
                    window.location.href = "csvparse.html";

                }else{
                    displayGradingCriteria(studentClass)
                // To show the notification
                    loading('block');
                   
        
            try {
                let querySnapshot = null;
                
                if(adnumber.split("_")[0]==='ad'){
                     querySnapshot = await getDocs(query(
                    
                    collection(db, "madrassaMark"),
                    
                   
                    where("adnumber", "==", adnumber.split("_")[1]),
                    where("class", "==", studentClass+" "+division)
                
                ));

                }else{
                     querySnapshot = await getDocs(query(
                    
                    collection(db, "madrassaMark"),
                    
                   
                    where("adnumber", "==", adnumber),
                    where("class", "==", studentClass+" "+division)
                
                ));
                }
            

                if (querySnapshot.empty) {
            
                    alert("‚ùå No records found for this student.");
                    loading('none');
                    return;
                }
                

                let studentData = [];
                let studentInfo = {};

                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                                    
                    studentData=  processSubjects(data);

                    studentInfo = {
                        name: data.name,
                        class: data.class,
                        division: data.division,
                        adnumber: data.adnumber,
                        fee:data.fee
                    };
                });

                displayProgressCard(adnumber, studentInfo, studentData);

            } catch (error) {
                console.error("‚ùå Error fetching student data:", error);
                alert("‚ùå Error fetching data: " + error.message);
            }
        }
    }
        );

        function processSubjects(data) {
            console.log(data);
    const subjectOrder = ["THAFHEEM (R)","THAFHEEM (W)","DUROOS (R)","DUROOS (W)","DEENIYATH&AQLAQ","DICTATION","FIQH","AQEEDA","LISAN","AQLAQ","QURAN","HIFL","THAJVEED","THAREEQ","DUROOS"];
    const studentData = [];

    if (Array.isArray(data.subjects)) {
        const subjectsMap = new Map(); // Use a Map to maintain the order of subjects from data.subjects
        data.subjects.forEach(sub => {
            subjectsMap.set(sub.subject, sub);
        });

        subjectOrder.forEach(subjectName => {
            if (subjectsMap.has(subjectName)) {
                const sub = subjectsMap.get(subjectName);
                studentData.push({
                    subject: sub.subject,
                    maxTeMark: sub.maxMark.split('_')[0],
                    obtTeMark: sub.obtMark.split('_')[0],
                    //maxCeMark: sub.maxMark.split('_')[1],
                    //obtCeMark: sub.obtMark.split('_')[1],
                });
            }
        });
    }

    return studentData;
}
        function resultHold (studentInfo){
            let progressHTML = `
       <div id="progressCard">
       <h1 class="arabic" style="margin-bottom:0px;">KYHSS ATHAVANAD</h1>
        <img id="loginemblom3" src="https://drive.google.com/thumbnail?id=1BKHBRTLhL6xokJ-Bz8fkM3hjllsKIqvb&sz=800" width="150" height="150" z-index="-900">
        
        <h2 style="margin-top:0px;margin-bottom:0.3em;" class="malayalam">School Code: 19094; HSS Code:11118</h2>
        <h3 style="margin-top: 0.2em;">PMSA ORPHANAGE CAMPUS KATTILANGADI</h3>
        <div class="progress-card">
            <p style="display: flex; gap: 10px; font-size:16px;"><strong>Name of Student : </strong><span style="color:red; font-weight:bold;">${studentInfo.name}</span></p >
            <p style="font-size:16px;"><strong>Admission Number:</strong> <span style="color:black; font-weight:bold;">${studentInfo.adnumber}</span></p>
            <p style="font-size:16px;"><strong>Class:</strong> ${studentInfo.class||""}</p>
            <table border="1" cellspacing="0" cellpadding="5" style="width: 100%; text-align: center;">
            <tr>
            <th>Subject</th>
            <th>Te Marks</th>
            <th>Ce Marks</th>
            <th>Grade</th>
            <th>Status</th>
            </tr>
            <tr>
            <td colspan="5" style="color: red; background-color: rgb(175, 233, 27); font-size: 18px;">
            Your Result is withheld due to Incomplete Fees Dues, Contact office for further details.
            </td>
            </tr>
            </table>
        </div>
   </div>   
   
    `;
    document.getElementById("printBtn").style.display = "flex";
    document.getElementById("searchField").style.display = "none";
    document.getElementById("progressCardContainer").innerHTML = progressHTML;
        }
    
        function displayProgressCard(adnumber, studentInfo, studentData) {
            if( ((adnumber.split("_")[0]||"")!=="ad") && studentInfo.fee>=1000){
                resultHold(studentInfo);
            }else{

            
    let progressHTML = `
       <div id="progressCard">
        <h1 class="arabic" style="margin-bottom:0px;">KYKHSS ATHAVANAD</h1>
        <img id="loginemblom3" src="https://drive.google.com/thumbnail?id=1BKHBRTLhL6xokJ-Bz8fkM3hjllsKIqvb&sz=800" width="150" height="150" z-index="-900">
            <h1 class="arabic" style="margin-bottom:0px;">School Madrassa</h1>
            <h2 style="margin-top:0px;margin-bottom:0.3em;" class="malayalam">School Code: 19094; HSS Code:11118</h2>
            <h3 style="margin-top: 0.2em;">PMSA ORPHANAGE CAMPUS KATTILANGADI</h3>
            <h2 style="color:red">Annual Examination Result</h2>
            <div class="progress-card">
                <p style="display: flex; gap: 10px; font-size:16px;"><strong>Name of Student : </strong><span style="color:red; font-weight:bold;">${studentInfo.name}</span></p >
                <p style="font-size:16px;"><strong>Admission Number:</strong> <span style="color:black; font-weight:bold;">${studentInfo.adnumber}</span></p>
                <p style="font-size:16px;"><strong>Class:</strong> ${studentInfo.class}</p>
                <table border="1" cellspacing="0" cellpadding="5" style="width: 100%; text-align: center;">
                    <tr>
                        <th>Subject</th>
                        <th>Te Marks</th>
                    
                        <th>Grade</th>
                        <th>Status</th>
                    </tr>
    `;

    let totalMarks = 0;
    let obtainedMarks = 0;
    let hasFailed = false; // Flag to check if the student failed
    let clason = (studentInfo.class).split(' ')[0];
    let abcount = null;
    studentData.forEach((subject) => {
        const totalObt = (parseFloat(subject.obtTeMark)||0);//+(parseFloat(subject.obtCeMark)||0)
        const totalMax = (parseFloat(subject.maxTeMark)||0);//+(parseFloat(subject.maxCeMark)||0)
        const grade = getGrade(totalMax,totalObt,clason);
        const isPassed = parseFloat(subject.obtTeMark)>=18; //||0)/(parseFloat(subject.maxTeMark)||0))*100 >= 30;
        const statusIcon = isPassed ? 'P':'F';//'‚úîÔ∏è' : '‚ùå'; // Tick for pass, Cross for fail
        const rowStyle = isPassed ? "" : 'style="background-color: #ffcccc; font-weight: bold;"'; // Red background for fail
        if (subject.obtTeMark === "Ab") {
  abcount++; // Increment abcount
}
        if (!isPassed) {
            hasFailed = true; // Mark as failed if any subject is below 18
        }

        progressHTML += `
            <tr ${rowStyle}>
                <td>${subject.subject}</td>
                <td>${subject.obtTeMark}/${subject.maxTeMark}</td>
                
                <td>${grade}</td> 
                <td>${statusIcon}</td>
            </tr>
        `;

        totalMarks += (parseInt(subject.maxTeMark)||0);//+(parseFloat(subject.maxCeMark)||0);
        obtainedMarks += (parseInt(subject.obtTeMark)||0);//+(parseFloat(subject.obtCeMark)||0);
    });

    let percentage = ((obtainedMarks / totalMarks) * 100).toFixed(2);

    progressHTML += `
                </table>
                 <div style="text-align: left;">
        <p><strong>Total Marks:</strong> ${obtainedMarks} / ${totalMarks}</p>

       <div style="display: flex; justify-content: space-between; margin:1px;">
             <p><strong>Percentage:</strong> ${percentage}%</p>
    <span> Result :
    <span style="font-size:12px; width:fit-content;max-width:200px; padding: 4px; border: 1px solid #ccc; border-radius: 1px; background-color: ${hasFailed?'#efafaf':'#abd8b5'}; align-items: center;justify-content: center; color: ${hasFailed?'red':'green'}; " id="status" >${hasFailed? (((studentInfo.class.split(" ")[0]) > 6) ? 'Faild- ReAppear':'Faild -Promoted'):'Passed'}</span>
    </span>
   </div>
</div>
        
    `;

    if (hasFailed) {
        //progressHTML += `<div class="faild" style="color: red; font-weight: bold;">‚ùå You have failed the exam. Try again! ‚ùå</div>`;
    } else {
        progressHTML += `<div class="congratulations hideprint" style="color: white; font-weight: bold;">üéâ Congratulations! You have passed successfully! üéâ</div>`;
    }

    progressHTML += `</div></div></div>`;
    if(abcount>10){
        document.getElementById("progressCardContainer").innerHTML = "<p style='color:red; font-size:18px;background-color:orange;'>Your result has been withheld by the office and is not available at this time. <h3>folowing are The Reasons</h3> <li> SSLC Scribe Helping Examiners</li><li>Continuous Absenteeis (more than 5 subjects)</li></p?";
        document.getElementById("printBtn").style.display = "flex";
        document.getElementById("searchField").style.display = "none";
}else{
    document.getElementById("progressCardContainer").innerHTML = progressHTML;
    document.getElementById("printBtn").style.display = "flex";
    document.getElementById("searchField").style.display = "none";
}
}

async function loadReport2() {
    const adnumber = document.getElementById("searchAdnumber").value.trim();
    if(!adnumber){
        alert("Please enter your Ad number");
    }
    try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbwI7-WkTLWQeTDzgyBlPio3o1ivUmfhHmhI7l60RXX7vPf1pnM2BaKRhIHu4QfF3mbz/exec', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                action: 'getFeeBalance',
                adnumber: adnumber,
                 
            })
        });
       // const response = await fetch(`https://script.google.com/macros/s/AKfycbwI7-WkTLWQeTDzgyBlPio3o1ivUmfhHmhI7l60RXX7vPf1pnM2BaKRhIHu4QfF3mbz/exec? action =scoreData & myUserMail= ${UserMail} & myclassName= ${className} & institution = School`);

console.log('usermail:'+adnumber)
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
    

        const result = await response.json();
        
        console.log(result);
        return result;
      
       // addrecord('maxMarks', result.maxMarks);
    } catch (error) {
        console.error('Error loading report:', error);
        // You might want to add some user-facing error handling here
    }
}
        }
//loadReport2();
    </script>
    

</body>
</html>
